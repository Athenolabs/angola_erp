[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Order", 
  "modified": "2016-11-25 13:42:56.640338", 
  "name": "Purchase Order-Client", 
  "script": "cur_frm.cscript.is_subcontracting = function(doc, cdt, cdn) {\r\n\tcur_frm.set_query(\"item_code\", \"items\", function(){\r\n\t\tif (cur_frm.doc.is_subcontracting == 1){\r\n\t\t\treturn{\r\n\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\r\n\t\t\t\tfilters:{ 'is_sub_contracted_item': 1 }\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn{\r\n\t\t\t\tquery: \"erpnext.controllers.queries.item_query\",\r\n\t\t\t\tfilters:{'is_purchase_item':1}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\nfrappe.ui.form.on(\"Purchase Order\", \"refresh\", function(frm) {\r\n\r\n// Get Items from Production Order\r\n// Get Items from Production Order\r\ncur_frm.add_custom_button(__('Production Order'),\r\n    function() {\r\n    var me = this;\r\n    this.dialog = new frappe.ui.Dialog({\r\n        title: \"Get Items from Production Order\",\r\n        fields: [\r\n            {\"fieldtype\": \"Link\", \"label\": __(\"Production Order\"), \"fieldname\": \"production_order\",\"options\":'Production Order',\"reqd\": 1, \r\n                get_query: function() { return {query: \"rigpl_erpnext.rigpl_erpnext.validations.purchase_order.get_pending_prd\"}},\r\n            },\r\n            {\"fieldtype\": \"Button\", \"label\": __(\"Get\"), \"fieldname\": \"get\"},\r\n            {\"fieldtype\": \"HTML\", \"fieldname\": \"production_order_items_details\"},\r\n        ],\r\n    });\r\n    me.dialog.show();\r\n    fd = this.dialog.fields_dict;\r\n    this.dialog.fields_dict.get.$input.click(function() {\r\n        value = me.dialog.get_values();\r\n\r\n    frappe.call({    \r\n        method: \"frappe.client.get_list\",\r\n           args: {\r\n            doctype: \"Production Order\",\r\n               fields: [\"production_item\", \"item_description \", \"sales_order\", \"so_detail\", \"qty\",\"fg_warehouse\",\"stock_uom\",\"name\"],\r\n               filters: { \"name\" : value.production_order\r\n                },\r\n            },\r\n            callback: function(res){\r\n            if(res && res.message){\r\n                    var row = frappe.model.add_child(cur_frm.doc, \"Purchase Order Item\", \"items\");\r\n                    row.qty = res.message[0]['qty'];\r\n\t\t\t\t\tif (cur_frm.doc.is_subcontracting == 1){\r\n\t\t\t\t\t\trow.subcontracted_item = res.message[0]['production_item'];\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\trow.item_code = res.message[0]['production_item'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\trow.description = res.message[0]['item_description'];\r\n                    row.so_detail = res.message[0]['so_detail'];\r\n                    row.uom = res.message[0]['stock_uom'];\r\n                    row.stock_uom = res.message[0]['stock_uom'];\r\n                    row.conversion_factor = 1;\r\n                refresh_field(\"items\");\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    });\r\n\r\n    add_production_order_items_to_stock = function(){\r\n        var items_to_add = []\r\n        value = me.dialog.get_values();\r\n        $.each($(fd.production_order_items_details.wrapper).find(\".select:checked\"), function(name, item){\r\n            items_to_add.push($(item).val());\r\n        });\r\n        if(items_to_add.length > 0){\r\n            for(i=0;i<items_to_add.length;i++){\r\n                add_production_order_items(items_to_add,i)\r\n            }\r\n            me.dialog.hide()\r\n        }    \r\n        else{\r\n            msgprint(\"Select Item Before Add\")\r\n        }\r\n    }\r\n}, __(\"Add items from\"));\r\n\r\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2016-11-25 13:42:56.677503", 
  "name": "Customer-Client", 
  "script": "cur_frm.add_fetch('charge','letter_head','letter_head');\r\nfrappe.ui.form.on(\"Customer\", \"refresh\", function(frm) {\r\n    frm.add_custom_button(__(\"Sales Call\"), function() {\r\n        // When this button is clicked, do this\r\n\t\t\tfrappe.set_route(\"Form\", \"Sales Call Tool\",\r\n\t\t\t{\"document\": \"Customer\",\r\n\t\t\t \"customer\": frm.doc.name,\r\n\t\t\t \"date_of_communication\": Date()});\r\n\r\n    },  __(\"Add Communication for\"));\r\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2016-11-25 19:42:50.711604", 
  "name": "Sales Order-Client", 
  "script": "taxavenda= cur_frm.call({method:\"gestoficinas.gestoficinas.doctype.cambios.cambios\",args:{\"fonte\":\"BNA\"}})\n\n\nfrappe.ui.form.on(\"Sales Order\",\"cambio_bna\", function(frm,cdt,cdn) {\n\n\t\tfrappe.call({\n\t\t\tasync: true,\n\t\t\tmethod: \"gestoficinas.gestoficinas.doctype.cambios.cambios\",\n\t\t\targs: {\n\t\t\t\t\"fonte\":\"BNA\"\t\t\t\t\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\ttaxavenda = r.message\n\t\t\t\tcur_frm.doc.taxa_cambio = taxavenda[1]\n\t\t\t\trefresh_field(\"taxa_cambio\")\n\t\t\t}\n\t\t});\n\n\n\n});\n\n\ncur_frm.cscript.custom_validate = function(doc, dt, dn) {\n\n    if (doc.docstatus == 0){\n\n\t\tif (frappe.datetime.get_day_diff(new Date(), frappe.datetime.str_to_obj(doc.transaction_date)) > 0 && doc.order_type == \"Sales\") {\n\t\t\t//Due to normal clients this have to be removed for now....\n\t\t\t//validated = false;\n\n\t\t\t//msgprint(\"Data de Ordem de Venda nao pode ser anterior de hoje\"); // or any other message you want..\n\n\t\t}\n\n\t}\t\n\n};", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Lead", 
  "modified": "2016-11-25 13:42:56.692738", 
  "name": "Lead-Client", 
  "script": "frappe.ui.form.on(\"Lead\", \"refresh\", function(frm) {\r\n    frm.add_custom_button(__(\"Sales Call\"), function() {\r\n        // When this button is clicked, do this\r\n\t\t\tfrappe.set_route(\"Form\", \"Sales Call Tool\",\r\n\t\t\t{\"document\": \"Lead\",\r\n\t\t\t \"lead\": frm.doc.name,\r\n\t\t\t \"date_of_communication\": Date()});\r\n\t\t\t \r\n    },  __(\"Add Communication for\"));\r\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2016-11-25 13:42:56.699416", 
  "name": "Item-Client", 
  "script": "frappe.provide(\"erpnext.item\");\r\n\r\nfrappe.ui.form.on(\"Item\", {\r\n\trefresh: function(frm) {\r\n\t\tif (frm.doc.has_variants) {\r\n\t\t\tfrm.add_custom_button(__(\"Make New Item Code\"), function() {\r\n\t\t\t\terpnext.item.make_variant_custom()\r\n\t\t\t}, \"icon-list\", \"btn-default\");\r\n\t\t}\r\n\t},\r\n});\r\n\r\n$.extend(erpnext.item, {\r\n\tget_hidden_fields: function(){\r\n\t\tvar ret = {}, cur_attrs = [];\r\n\t\tcur_frm.doc.attributes.forEach(function(d){\r\n\t\t\tcur_attrs.push(d.attribute);\r\n\t\t});\r\n\t\tfrappe.call({\r\n\t\t\t'async': false,\r\n\t\t\t'method': 'frappe.client.get_list',\r\n\t\t\t'args': {\r\n\t\t\t\t'doctype': 'Item Attribute',\r\n\t\t\t\t'filters': [\r\n\t\t\t\t    ['Item Attribute', 'hidden', '=', 1],\r\n\t\t\t\t\t['Item Attribute', 'name', 'in', cur_attrs]\r\n\t\t\t\t],\r\n\t\t\t\tfields: [\r\n\t\t\t\t\t'name', 'update_from', 'source', 'relation'\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\t'callback': function(res){\r\n\t\t\t\t(res.message || []).forEach(function(r){\r\n\t\t\t\t\tvar only_allowed, options = [] ;\r\n\t\t\t\t\tif (!ret.hasOwnProperty(r.update_from)){\r\n\t\t\t\t\t\tret[r.update_from] = {};\r\n\t\t\t\t\t\tret[r.update_from]['source'] = r.source;\r\n\t\t\t\t\t\tret[r.update_from]['options'] = {}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tret[r.update_from][r.name] = r.relation;\r\n\t\t\t\t\tret[r.name] = r.update_from;\r\n\t\t\t\t\tonly_allowed = frappe.utils.filter_dict(cur_frm.doc.item_variant_restrictions, {\"attribute\": r.name});\r\n\t\t\t\t\t(only_allowed || []).forEach(function(d){\r\n\t\t\t\t\t\toptions.push(d.attribute)\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!options.length){\r\n\t\t\t\t\t\tfrappe.call({\r\n\t\t\t\t\t\t\t'async': false,\r\n\t\t\t\t\t\t\t'method': 'frappe.client.get_list',\r\n\t\t\t\t\t\t\t'args': {\r\n\t\t\t\t\t\t\t\t'doctype': 'Item Attribute Value',\r\n\t\t\t\t\t\t\t\t'filters': [\r\n\t\t\t\t\t\t\t\t\t['Item Attribute Value', 'parent', '=', r.name]\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t'fields': ['attribute_value'],\r\n\t\t\t\t\t\t\t\t'limit_page_length': 500\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t'callback': function(res){\r\n\t\t\t\t\t\t\t\t(res.message || []).forEach(function(r){\r\n\t\t\t\t\t\t\t\t\toptions.push(r.attribute_value);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tret[r.update_from]['options'][r.name] = options;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t},\r\n\tget_conversion_factors: function(from_uom, to_uom){\r\n\t\tvar ret;\r\n\t\tfrappe.call({\r\n\t\t\t'async': false,\r\n\t\t\t'method': 'rigpl_erpnext.rigpl_erpnext.item.get_uom_factors',\r\n\t\t\t'args':{\r\n\t\t\t\t'from_uom': from_uom,\r\n\t\t\t\t'to_uom': to_uom\r\n\t\t\t},\r\n\t\t\t'callback': function(res){\r\n\t\t\t\tret = res.message;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t},\r\n\tmake_variant_custom: function(doc) {\r\n\t\tvar fields = [], hidden_fields = this.get_hidden_fields(doc);\r\n\t\tfor(var i=0;i< cur_frm.doc.attributes.length;i++){\r\n\t\t\tvar row = cur_frm.doc.attributes[i],\r\n\t\t\t    field, creator;\r\n\t\t\tif (!hidden_fields.hasOwnProperty(row.attribute)){\r\n\t\t\t\tfield = {\r\n\t\t\t\t\t\"label\": (row.attribute + \" (\"+ row.field_name + \")\"),\r\n\t\t\t\t\t\"fieldname\": row.attribute,\r\n\t\t\t\t\t\"reqd\": 1,\r\n\t\t\t\t\t\"fieldtype\": row.numeric_values ? \"Float\": \"Select\",\r\n\t\t\t\t\t\"description\": row.numeric_values ?  \"Min Value: \"+ row.from_range +\" , Max Value: \"+ row.to_range +\", in Increments of: \"+ row.increment : \"\"\r\n\t\t\t\t}\r\n\t\t\t\tif (field.fieldtype==='Select') {\r\n\t\t\t\t\tvar filters = [\r\n\t\t\t\t\t\t\t['parent', '=', row.attribute],\r\n\t\t\t\t\t], allowed = [], options = [null];\r\n\t\t\t\t\tfrappe.utils.filter_dict(cur_frm.doc.item_variant_restrictions, {'attribute': row.attribute}).forEach(function(d){\r\n\t\t\t\t\t\tif (d.allowed_values) allowed.push(d.allowed_values);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (allowed.length){\r\n\t\t\t\t\t\toptions = options.concat(allowed);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfrappe.call({\r\n\t\t\t\t\t\t\t'method': 'frappe.client.get_list',\r\n\t\t\t\t\t\t\t'async': false,\r\n\t\t\t\t\t\t\t'args': {\r\n\t\t\t\t\t\t\t\t'doctype': 'Item Attribute Value',\r\n\t\t\t\t\t\t\t\t'filters': filters,\r\n\t\t\t\t\t\t\t\t'fields': ['attribute_value']\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t'callback': function(res){\r\n\t\t\t\t\t\t\t\tres.message.forEach(function(d){\r\n\t\t\t\t\t\t\t\t\toptions.push(d.attribute_value);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfield.options = options;\r\n\t\t\t\t\tfields.push(field)\r\n\t\t\t\t}\r\n\t\t\t} else if (!hidden_fields[hidden_fields[row.attribute]].created){\r\n\t\t\t\tcreator = hidden_fields[row.attribute];\r\n\t\t\t\tfield = {\r\n\t\t\t\t\t'label': (creator + \" (\"+ row.field_name + \")\"),\r\n\t\t\t\t\t'fieldname': creator,\r\n\t\t\t\t\t'reqd': 1,\r\n\t\t\t\t\t'fieldtype': 'Data',\r\n\t\t\t\t};\r\n\t\t\t\thidden_fields[creator].created = true;\r\n\t\t\t\tfields.push(field)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar d = new frappe.ui.Dialog({\r\n\t\t\ttitle: __(\"Make Variant Custom\"),\r\n\t\t\tfields: fields\r\n\t\t});\r\n\t\t\r\n\t\tObject.keys(d.fields_dict).forEach(function(fieldname){\r\n\t\t\tif (d.fields_dict[fieldname].df.fieldtype!=='Data') return;\r\n\t\t\t\r\n\t\t\tvar field = d.fields_dict[fieldname],\r\n\t\t\t\ttarget = field.$input.parent(),\r\n\t\t\t    options = $('<ul class=\"dropdown-menu\"></ul>');\r\n\t\t\t\r\n\t\t\tObject.keys(hidden_fields[fieldname]).forEach(function(key){\r\n\t\t\t\tif (in_list(['created', 'source', 'options'], key)) return;\r\n\t\t\t\t\r\n\t\t\t\tvar option = $(format('<li><a data-option=\"{0}\">{0}</a></li>', [hidden_fields[fieldname][key]]));\r\n\t\t\t\toption.find('a').on('click', function(evt){\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\tvar text = options.parent().find('button').text();\r\n\t\t\t\t\tif (text === $(this).text()) return;\r\n\t\t\t\t\toptions.parent().find('button').text($(this).text());\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (target.hasClass('ui-front')){\r\n\t\t\t\t\t\tfield.$input.autocomplete('destroy');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttarget.addClass('ui-front');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ((hidden_fields[fieldname].options[key]||'').length){\r\n\t\t\t\t\t\tfield.$input.autocomplete({\r\n\t\t\t\t\t\t\tminChars: 0,\r\n\t\t\t\t\t\t\tminLength: 0,\r\n\t\t\t\t\t\t\tsource: hidden_fields[fieldname].options[key],\r\n\t\t\t\t\t\t\tselect: function(event, ui){\r\n\t\t\t\t\t\t\t\tfield.$input.val(ui.item.value);\r\n\t\t\t\t\t\t\t\tfield.$input.trigger('change');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\toptions.append(option);\r\n\t\t\t});\r\n\t\t\t\t\r\n\t\t\t$(format('<div class=\"input-group-btn\">\\\r\n\t\t\t\t <button type=\"button\" class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" data-fieldname=\"{1}\" aria-expanded=\"false\">{0}<span class=\"caret\"></span></button>\\\r\n\t\t\t  </div>', __([hidden_fields[fieldname].source, fieldname]))).append(options).prependTo(target);\r\n\t\t\t\r\n\t\t\ttarget.addClass('input-group');\r\n\t\t\t\r\n\t\t\tfield.$input.on('change', function(evt){\r\n\t\t\t\tif (!field.$input.val().length) return;\r\n\t\t\t\tvar uom = options.parent().find('button').text();\r\n\t\t\t\tif (uom===hidden_fields[fieldname].source){\r\n\t\t\t\t\tfield.$input.val(\"\");\r\n\t\t\t\t\tfrappe.throw(format('Select the \"{0}\" of the field \"{1}\"\", first!', [hidden_fields[fieldname].source, fieldname]))\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\td.set_primary_action(__(\"Make\"), function() {\r\n\t\t\tvar rules = {},\r\n\t\t\targs = d.get_values();\r\n\t\t\tif(!args) return;\r\n\t\t\t\r\n\t\t\tfrappe.utils.filter_dict(cur_frm.doc.item_variant_restrictions, {'is_numeric': 1}).forEach(function(d){\r\n\t\t\t\tif (!rules.hasOwnProperty(d.attribute)) rules[d.attribute] = [];\r\n\t\t\t\trules[d.attribute].push(d.rule);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.keys(args).filter(function(key){ return hidden_fields.hasOwnProperty(key); }).forEach(function(key){\r\n\t\t\t\tvar val = args[key], base, targets = Object.keys(hidden_fields[key]).filter(function(k){ return !in_list(['created', 'source', 'options'], k)});\r\n\t\t\t\ttry {\r\n\t\t\t\t\tbase = eval(val);\r\n\t\t\t\t} catch( e ){\r\n\t\t\t\t\tfrappe.throw(format('Failed to decode the value \"{0}\"', [val]));\r\n\t\t\t\t}\r\n\t\t\t\ttargets.forEach(function(tgt){\r\n\t\t\t\t\tvar uom = d.fields_dict[key].$input.parent().find('button').text(),\r\n\t\t\t\t\t\ttgt_uom = hidden_fields[key][tgt],\r\n\t\t\t\t\t    factors = erpnext.item.get_conversion_factors(uom, tgt_uom);\r\n\t\t\t\t\tif (uom === tgt_uom) {\r\n\t\t\t\t\t\targs[tgt] = val.indexOf('/') === -1 ? flt(val) : val;\r\n\t\t\t\t\t} else if (factors.rgt){\r\n\t\t\t\t\t\targs[tgt] = flt((base * factors.rgt).toFixed(frappe.defaults.get_global_default('float_precision')));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t    delete args[key];\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tconsole.table(Object.keys(args).map(function(k){ return {'key': k, 'value': args[k]}}));\r\n\t\t\t//debugger;\r\n\t\t\tObject.keys(args).forEach(function(attribute){\r\n\t\t\t\tif (!rules.hasOwnProperty(attribute)) return;\r\n\t\t\t\tvar msg = [];\r\n\t\t\t\tfor (var i=0, j=rules[attribute].length; i < j; i++){\r\n\t\t\t\t\twith (args){\r\n\t\t\t\t\t\tout = eval(rules[attribute][i]);\r\n\t\t\t\t\t\tif (!out){\r\n\t\t\t\t\t\t\tmsg.push(format('Unable for ensure the rule \"{1}\" for the field \"{0}\"', [attribute, rules[attribute][i]]));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (msg.length){\r\n\t\t\t\t\tfrappe.throw(msg.join('<br>'))\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tObject.keys(args).forEach(function(attribute){ args[attribute] = args[attribute] + '';});\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod:\"erpnext.controllers.item_variant.get_variant\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\t\"template\": cur_frm.doc.name,\r\n\t\t\t\t\t\"args\": args\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t// returns variant item\r\n\t\t\t\t\tif (r.message) {\r\n\t\t\t\t\t\tvar variant = r.message;\r\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\",\r\n\t\t\t\t\t\t\t[repl('<a href=\"#Form/Item/%(item_encoded)s\" class=\"strong variant-click\">%(item)s</a>', {\r\n\t\t\t\t\t\t\t\titem_encoded: encodeURIComponent(variant),\r\n\t\t\t\t\t\t\t\titem: variant\r\n\t\t\t\t\t\t\t})]\r\n\t\t\t\t\t\t));\r\n\t\t\t\t\t\tmsgprint_dialog.hide_on_page_refresh = true;\r\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\r\n\t\t\t\t\t\t\td.hide();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\td.hide();\r\n\t\t\t\t\t\tfrappe.call({\r\n\t\t\t\t\t\t\tmethod:\"erpnext.controllers.item_variant.create_variant\",\r\n\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\t\"item\": cur_frm.doc.name,\r\n\t\t\t\t\t\t\t\t\"args\": args\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcallback: function(r) {\r\n\t\t\t\t\t\t\t\tvar doclist = frappe.model.sync(r.message);\r\n\t\t\t\t\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\td.show();\r\n\t},\r\n\ttoggle_attributes: function(frm) {\r\n\t\tfrm.toggle_display(\"attributes\", frm.doc.has_variants || frm.doc.variant_of);\r\n\t\tfrm.fields_dict.attributes.grid.toggle_reqd(\"attribute_value\", frm.doc.variant_of ? 1 : 0);\r\n\t\tfrm.fields_dict.attributes.grid.set_column_disp(\"attribute_value\", frm.doc.variant_of ? 1 : 0);\r\n\t}\r\n});\r\n\r\ncur_frm.cscript.custom_onload = function () {\r\n\tif (cur_frm.doc.has_variants == 1) {\r\n\t\tcur_frm.set_query('attribute', 'attributes', function(){\r\n\t\t\treturn {\r\n\t\t\t\tfilters: [\r\n\t\t\t\t\t['Item Attribute', 'virtual', '=', 0]\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t});\r\n\t\tcur_frm.set_query('attribute', 'item_variant_restrictions', function(){\r\n\t\t\tvar attrs = []\r\n\t\t\tcur_frm.doc.attributes.forEach(function(row){\r\n\t\t\t\tattrs.push(row.attribute)\r\n\t\t\t});\r\n\t\t\treturn {'filters': [['Item Attribute', 'name', 'in', attrs]]}\r\n\t\t});\r\n\t\t\r\n\t}\r\n}\r\n//Below code would disable the attribute table after being saved.\r\nfrappe.ui.form.on(\"Item\", \"refresh\", function(frm){\r\n    frm.fields_dict.attributes.grid.df.read_only = frm.doc.__islocal ? false: true;\r\n\tfrm.fields_dict.attributes.grid.docfields.forEach(function(field){\r\n\t\tfield.read_only = frm.doc.__islocal ? false: true;\r\n\t});\r\n    frm.refresh_field(\"attributes\");\r\n});\r\n\r\nfrappe.ui.form.on(\"Item Variant Restrictions\", \"form_render\", function(frm, cdt, cdn){\r\n\tvar field = cur_frm.fields_dict.item_variant_restrictions.grid.grid_rows_by_docname[cdn].fields_dict.allowed_values;\r\n\t$(field.input_area).addClass('ui-front');\r\n\tfield.$input.autocomplete({\r\n\t\tminChars: 0,\r\n\t\tminLength: 0,\r\n\t\tsource: function(request, response){\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: 'frappe.client.get_list',\r\n\t\t\t\targs: {\r\n\t\t\t\t\tdoctype: 'Item Attribute Value',\r\n\t\t\t\t\tfilters: [\r\n\t\t\t\t\t\t['parent', '=', field.doc.attribute],\r\n\t\t\t\t\t\t['attribute_value', 'like', request.term + '%']\r\n\t\t\t\t\t],\r\n\t\t\t\t\tfields: ['attribute_value']\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function(res){\r\n\t\t\t\t\tresponse($.map(res.message, function(d){ return d.attribute_value;}));\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tselect: function(event, ui){\r\n\t\t\tfield.$input.val(ui.item.value);\r\n\t\t\tfield.$input.trigger('change');\r\n\t\t}\r\n\t});\r\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Communication", 
  "modified": "2016-11-25 13:42:56.705667", 
  "name": "Communication-Client", 
  "script": "$.extend(frappe.views.CommunicationComposer, {\r\n\t\r\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Salary Slip", 
  "modified": "2016-11-25 13:54:52.497705", 
  "name": "Salary Slip-Client", 
  "script": "// Copyright (c) 2016, HELKyds lda. and contributors\n// For license information, please see license.txt\n//IRT_INSS v1\n\n\nvar irt=0;\nvar inss=0;\nvar salario = 0;\nvar numero_faltas =0;\nvar valor_inicio =0;\nvar valor_fim = 0;\nvar valor_percentual = 0;\nvar parcela_fixa = 0;\n\nlista_irt = cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.get_lista_irt\",args:{}})\n\n\n\nfrappe.ui.form.on('Salary Slip', {\n\n\trefresh: function(frm) {\n\n\t\t\t//Get Salario\n\n\t\tvar tbl1 = frm.doc.earnings || [];\n\n//\t\tvar tbl2 = frm.doc.deductions || [];\n\n\t\tinss_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.get_inss\",args:{}})\t\n\n\t\tif (frm.doc.employee != undefined){\n\t\t\tif (numero_faltas.readyState == 4){\n\t\t\t\tcur_frm.doc.numero_de_faltas = numero_faltas.responseJSON.message[0]\n\t\t\t}else{\n\t\t\t\tnumero_faltas = cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.get_faltas\",args:{\"emp\":frm.doc.employee, \"mes\":frm.doc.month, \"ano\":frm.doc.fiscal_year}}) \n\t\t\t}\n\n\t\t}else if (numero_faltas !=0){\n\t\t\tif (numero_faltas.readyState != 1){\n\t\t\t\tcur_frm.doc.numero_de_faltas = numero_faltas.responseJSON.message[0]\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor(var i = 0; i < tbl1.length; i++){\n\n\t\t\tif (tbl1[i].salary_component == \"Salario Base\" || tbl1[i].salary_component == \"Basic\" && tbl1[i].amount != 0){\n\n\t\t\t\tsalario = tbl1[i].amount\n\t\t\t\tif (lista_irt.readyState !=1){\n\t\t\t\t\tfor (var x =0; x < lista_irt.responseJSON.message.length; x++){\n\t\t\t\t\t\t//valor_inicio <= %(start)s and valor_fim >=%(start)s\n\t\t\t\t\t\tif (lista_irt.responseJSON.message[x].valor_inicio <= salario && lista_irt.responseJSON.message[x].valor_fim >= salario){\n\t\t\t\t\t\t\tvalor_inicio = lista_irt.responseJSON.message[x].valor_inicio\n\t\t\t\t\t\t\tvalor_fim = lista_irt.responseJSON.message[x].valor_fim\n\t\t\t\t\t\t\tvalor_percentual = lista_irt.responseJSON.message[x].valor_percentual\n\t\t\t\t\t\t\tparcela_fixa = lista_irt.responseJSON.message[x].parcela_fixa\t\n\t\t\t\t\t\t\tx = lista_irt.responseJSON.message.length +1 \n\t\n\t\t\t\t\t\t}else if (lista_irt.responseJSON.message[x].valor_fim >= salario){\n\t\t\t\t\t\t\tvalor_inicio = lista_irt.responseJSON.message[x].valor_inicio\n\t\t\t\t\t\t\tvalor_fim = lista_irt.responseJSON.message[x].valor_fim\n\t\t\t\t\t\t\tvalor_percentual = lista_irt.responseJSON.message[x].valor_percentual\n\t\t\t\t\t\t\tparcela_fixa = lista_irt.responseJSON.message[x].parcela_fixa\t\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tirt_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.get_irt\",args:{\"start\":salario}})\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\t\n\n\n\n\t\tif(!frm.doc.__islocal) {\n\n\t\t\tcur_frm.add_custom_button(__('Calcular IRT & INSS'),cur_frm.cscript['calcular_irt_inss'], \"icon-exclamation\", \"btn-default\");\n\n\n\t\t}\n\n\n\t},\n\n\t\n\n\t\n\n});\n\n\n\n\ncur_frm.cscript.calcular_irt_inss = function(doc,cdt,cdn){\n\n\n//\t\t\tcur_frm.add_custom_button(__('Calcular IRT & INSS'),function(doc, cdt, cdn) {\n\n\t\tvar tbl1 = cur_frm.doc.earnings || [];\n\n\t\tvar tbl2 = cur_frm.doc.deductions || [];\n\n\t\t\t\tfor(var i = 0; i < tbl1.length; i++){\n\n\t\t\t\t\tif (tbl1[i].salary_component == \"Salario Base\" || tbl1[i].salary_component == \"Basic\" && tbl1[i].amount != 0){\n\n\t\t\t\t\t\tif (valor_fim !=0){\n\t\t\t\t\t\t\tirt = flt(salario) - valor_inicio;\n\n\t\t\t\t\t\t\tirt = (irt * valor_percentual/ 100) + parcela_fixa;\n \t\t\t\t\t\t\n\t\t\t\t\t\t}else if (irt_valor.responseJSON.message[0].valor_inicio !=undefined){\n\n\t\t\t\t\t\t\tirt = flt(salario) - irt_valor.responseJSON.message[0].valor_inicio;\n\n\t\t\t\t\t\t\tirt = (irt * irt_valor.responseJSON.message[0].valor_percentual/ 100) + irt_valor.responseJSON.message[0].parcela_fixa;\n\n\t\t\t\t\t\t}else{\n\n\t\t\t\t\t\t\tirt = flt(salario) - irt_valor.responseJSON.message[0][0];\n\n\t\t\t\t\t\t\tirt = (irt * irt_valor.responseJSON.message[0][2]/ 100) + irt_valor.responseJSON.message[0][3];\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\n\n\t\t\t\t\t}\t\t\t\t\t\n\n\t\t\t\t}\n\n\t\t\t\ttotaldeducoes = 0\n\t\t\t\tfor(var j = 0; j < tbl2.length; j++){\n\n\t\t\t\t\tif (tbl2[j].salary_component == \"IRT\" ){\n\n\t\t\t\t\t\tirt_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.set_ded\",args:{\"ded\":tbl2[j].name,\"d_val\":irt}});\n\n\t\t\t\t\t}else if (tbl2[j].salary_component == \"INSS\" ){\t\n\n\t\t\t\t\t\tif (inss_valor.responseJSON.message !=undefined){\n\n\t\t\t\t\t\t\t//inss_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.get_inss\",args:{}})\t\n\n\t\t\t\t\t\t\tinss_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.set_ded\",args:{\"ded\":tbl2[j].name,\"d_val\":flt(salario)*inss_valor.responseJSON.message}});\n\n\t\t\t\t\t\t}else{\n\n\t\t\t\t\t\t\talert(\"INSS\")\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}else if (tbl2[j].salary_component == \"Faltas Injustificadas\" ){\t\n\t\t\t\t\t\t//so pode ser feito no SALARY SLIP due to the Month being processed.\n\t\t\t\t\t\t//alert(total_days_in_month - numero_faltas.responseJSON.message[0])\n\t\t\t\t\t\t\t//desconto_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.set_ded\",args:{\"ded\":tbl2[j].name,\"d_val\":(flt(salario)/26)*numero_faltas.responseJSON.message[0]}});\n\n\t\t\t\t\t\t//OUTRA Formula para desconto de Faltas SB/26/2+SB/26*numero_faltas\n\t\t\t\t\t\tdesconto_valor =cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.set_ded\",args:{\"ded\":tbl2[j].name,\"d_val\":(((flt(salario)/26)/2)+(flt(salario)/26))*numero_faltas.responseJSON.message[0]}});\n\n\t\t\t\t\t\t//if leave without pay 0 than payment days less numero_faltas otherwise working days - leave without - numero_faltas\n\t\t\t\t\t\tif (cur_frm.doc.leave_without_pay ==0){\n\t\t\t\t\t\t\tpagamentodias = cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.set_salary_slip_pay_days\",args:{\"emp\":cur_frm.doc.employee, \"mes\":cur_frm.doc.month, \"ano\":cur_frm.doc.fiscal_year, \"pag\":(cur_frm.doc.total_days_in_month - numero_faltas.responseJSON.message[0]) }});\n\t\t\t\t\t\t\tfrappe.model.set_value(cur_frm.doc.doctype,cur_frm.doc.name,'payment_days',cur_frm.doc.total_days_in_month  - numero_faltas.responseJSON.message[0]) \n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tpagamentodias = cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.set_salary_slip_pay_days\",args:{\"emp\":cur_frm.doc.employee, \"mes\":cur_frm.doc.month, \"ano\":cur_frm.doc.fiscal_year, \"pag\":(cur_frm.doc.total_days_in_month - cur_frm.doc.leave_without_pay - numero_faltas.responseJSON.message[0]) }});\n\t\n\t\t\t\t\t\t}\n\n\n\n\t\t\t\t\t}\t\n\t\t\t\t\ttotaldeducoes += tbl2[j].amount\n\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//calculate_earning_total(cur_frm.doc, cur_frm.doc.doctype, cur_frm.doc.name,true);\n\n\t\t\t\t//calculate_ded_total(cur_frm.doc, cur_frm.doc.doctype, cur_frm.doc.name,true);\n//\t\t\t\tcur_frm.doc.total_deduction = totaldeducoes\n\t\t\t\tfrappe.model.set_value(cur_frm.doc.doctype,cur_frm.doc.name,'total_deduction',totaldeducoes)\n\t\t\t\trefresh_field('gross_pay','total_deduction');\n\t\t\t\tcalculate_net_pay(cur_frm.doc, cur_frm.doc.doctype, cur_frm.doc.name);\n\n\n//\t\t\t\tcur_frm.refresh()\n\n//\t\t\t\tcur_frm.reload_doc()\n\n\n//\t\t\t});\n}", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Process Payroll", 
  "modified": "2016-11-25 14:23:08.196888", 
  "name": "Process Payroll-Client", 
  "script": "// Copyright (c) 2016, HELKyds lda. and contributors\n// For license information, please see license.txt\n//IRT_INSS v1\n\nvar irt=0;\nvar inss=0;\nvar salario = 0;\nvar numero_faltas =0;\nvar valor_inicio =0;\nvar valor_fim = 0;\nvar valor_percentual = 0;\nvar parcela_fixa = 0;\n\nlista_irt = cur_frm.call({method:\"angola_erp.angola_erpnext.validations.irt.get_lista_irt\",args:{}})\n\n\nfrappe.ui.form.on('Process Payroll', {\n\tprocessar_faltas:  function(doc, cdt, cdn){\n\n\t\talert(\"botao\")\n\t\talert(lista_irt)\n\t}\n});", 
  "script_type": "Client"
 }
]